async function xe(e,t){const r=await e.formData();if(r)return ye(r,t);return{}}function ye(e,t){const r=Object.create(null);if(e.forEach((s,n)=>{if(!(t.all||n.endsWith("[]")))r[n]=s;else be(r,n,s)}),t.dot)Object.entries(r).forEach(([s,n])=>{if(s.includes("."))ve(r,s,n),delete r[s]});return r}var ee=async(e,t=Object.create(null))=>{const{all:r=!1,dot:s=!1}=t,i=(e instanceof F?e.raw.headers:e.headers).get("Content-Type");if(i?.startsWith("multipart/form-data")||i?.startsWith("application/x-www-form-urlencoded"))return xe(e,{all:r,dot:s});return{}},be=(e,t,r)=>{if(e[t]!==void 0)if(Array.isArray(e[t]))e[t].push(r);else e[t]=[e[t],r];else e[t]=r},ve=(e,t,r)=>{let s=e;const n=t.split(".");n.forEach((i,a)=>{if(a===n.length-1)s[i]=r;else{if(!s[i]||typeof s[i]!=="object"||Array.isArray(s[i])||s[i]instanceof File)s[i]=Object.create(null);s=s[i]}})};var K=(e)=>{const t=e.split("/");if(t[0]==="")t.shift();return t},te=(e)=>{const{groups:t,path:r}=Re(e),s=K(r);return we(s,t)},Re=(e)=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,s)=>{const n=`@${s}`;return t.push([n,r]),n}),{groups:t,path:e}},we=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[s]=t[r];for(let n=e.length-1;n>=0;n--)if(e[n].includes(s)){e[n]=e[n].replace(s,t[r][1]);break}}return e},I={},V=(e)=>{if(e==="*")return"*";const t=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(t){if(!I[e])if(t[2])I[e]=[e,t[1],new RegExp("^"+t[2]+"$")];else I[e]=[e,t[1],!0];return I[e]}return null},Pe=(e)=>{try{return decodeURI(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,(t)=>{try{return decodeURI(t)}catch{return t}})}},z=(e)=>{const t=e.url,r=t.indexOf("/",8);let s=r;for(;s<t.length;s++){const n=t.charCodeAt(s);if(n===37){const i=t.indexOf("?",s),a=t.slice(r,i===-1?void 0:i);return Pe(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(n===63)break}return t.slice(r,s)};var se=(e)=>{const t=z(e);return t.length>1&&t[t.length-1]==="/"?t.slice(0,-1):t},w=(...e)=>{let t="",r=!1;for(let s of e){if(t[t.length-1]==="/")t=t.slice(0,-1),r=!0;if(s[0]!=="/")s=`/${s}`;if(s==="/"&&r)t=`${t}/`;else if(s!=="/")t=`${t}${s}`;if(s==="/"&&t==="")t="/"}return t},m=(e)=>{if(!e.match(/\:.+\?$/))return null;const t=e.split("/"),r=[];let s="";return t.forEach((n)=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){if(r.length===0&&s==="")r.push("/");else r.push(s);const i=n.replace("?","");s+="/"+i,r.push(s)}else s+="/"+n}),r.filter((n,i,a)=>a.indexOf(n)===i)},C=(e)=>{if(!/[%+]/.test(e))return e;if(e.indexOf("+")!==-1)e=e.replace(/\+/g," ");return/%/.test(e)?D(e):e},re=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let a=e.indexOf(`?${t}`,8);if(a===-1)a=e.indexOf(`&${t}`,8);while(a!==-1){const c=e.charCodeAt(a+t.length+1);if(c===61){const o=a+t.length+2,l=e.indexOf("&",o);return C(e.slice(o,l===-1?void 0:l))}else if(c==38||isNaN(c))return"";a=e.indexOf(`&${t}`,a+1)}if(s=/[%+]/.test(e),!s)return}const n={};s??=/[%+]/.test(e);let i=e.indexOf("?",8);while(i!==-1){const a=e.indexOf("&",i+1);let c=e.indexOf("=",i);if(c>a&&a!==-1)c=-1;let o=e.slice(i+1,c===-1?a===-1?void 0:a:c);if(s)o=C(o);if(i=a,o==="")continue;let l;if(c===-1)l="";else if(l=e.slice(c+1,a===-1?void 0:a),s)l=C(l);if(r){if(!(n[o]&&Array.isArray(n[o])))n[o]=[];n[o].push(l)}else n[o]??=l}return t?n[t]:n},ne=re,ie=(e,t)=>{return re(e,t,!0)},D=decodeURIComponent;var F=class{raw;#s;#r;routeIndex=0;path;bodyCache={};constructor(e,t="/",r=[[]]){this.raw=e,this.path=t,this.#r=r,this.#s={}}param(e){return e?this.getDecodedParam(e):this.getAllDecodedParams()}getDecodedParam(e){const t=this.#r[0][this.routeIndex][1][e],r=this.getParamValue(t);return r?/\%/.test(r)?D(r):r:void 0}getAllDecodedParams(){const e={},t=Object.keys(this.#r[0][this.routeIndex][1]);for(let r of t){const s=this.getParamValue(this.#r[0][this.routeIndex][1][r]);if(s&&typeof s==="string")e[r]=/\%/.test(s)?D(s):s}return e}getParamValue(e){return this.#r[1]?this.#r[1][e]:e}query(e){return ne(this.url,e)}queries(e){return ie(this.url,e)}header(e){if(e)return this.raw.headers.get(e.toLowerCase())??void 0;const t={};return this.raw.headers.forEach((r,s)=>{t[s]=r}),t}async parseBody(e){return this.bodyCache.parsedBody??=await ee(this,e)}cachedBody=(e)=>{const{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;const n=Object.keys(t)[0];if(n)return t[n].then((i)=>{if(n==="json")i=JSON.stringify(i);return new Response(i)[e]()});return t[e]=r[e]()};json(){return this.cachedBody("json")}text(){return this.cachedBody("text")}arrayBuffer(){return this.cachedBody("arrayBuffer")}blob(){return this.cachedBody("blob")}formData(){return this.cachedBody("formData")}addValidatedData(e,t){this.#s[e]=t}valid(e){return this.#s[e]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return this.#r[0].map(([[,e]])=>e)}get routePath(){return this.#r[0].map(([[,e]])=>e)[this.routeIndex].path}};var oe={Stringify:1,BeforeStream:2,Stream:3},He=(e,t)=>{const r=new String(e);return r.isEscaped=!0,r.callbacks=t,r};var W=async(e,t,r,s,n)=>{const i=e.callbacks;if(!i?.length)return Promise.resolve(e);if(n)n[0]+=e;else n=[e];const a=Promise.all(i.map((c)=>c({phase:t,buffer:n,context:s}))).then((c)=>Promise.all(c.filter(Boolean).map((o)=>W(o,t,!1,s,n))).then(()=>n[0]));if(r)return He(await a,i);else return a};var Oe="text/plain; charset=UTF-8",_=(e,t={})=>{return Object.entries(t).forEach(([r,s])=>e.set(r,s)),e},P=class{#s;#r;env={};#i;finalized=!1;error;#a=200;#o;#e;#t;#n;#c=!0;#h;#l;#f;#u;#d;constructor(e,t){if(this.#s=e,t)this.#o=t.executionCtx,this.env=t.env,this.#f=t.notFoundHandler,this.#d=t.path,this.#u=t.matchResult}get req(){return this.#r??=new F(this.#s,this.#d,this.#u),this.#r}get event(){if(this.#o&&"respondWith"in this.#o)return this.#o;else throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#o)return this.#o;else throw Error("This context has no ExecutionContext")}get res(){return this.#c=!1,this.#n||=new Response("404 Not Found",{status:404})}set res(e){if(this.#c=!1,this.#n&&e){this.#n.headers.delete("content-type");for(let[t,r]of this.#n.headers.entries())if(t==="set-cookie"){const s=this.#n.headers.getSetCookie();e.headers.delete("set-cookie");for(let n of s)e.headers.append("set-cookie",n)}else e.headers.set(t,r)}this.#n=e,this.finalized=!0}render=(...e)=>{return this.#l??=(t)=>this.html(t),this.#l(...e)};setLayout=(e)=>this.#h=e;getLayout=()=>this.#h;setRenderer=(e)=>{this.#l=e};header=(e,t,r)=>{if(t===void 0){if(this.#e)this.#e.delete(e);else if(this.#t)delete this.#t[e.toLocaleLowerCase()];if(this.finalized)this.res.headers.delete(e);return}if(r?.append){if(!this.#e)this.#c=!1,this.#e=new Headers(this.#t),this.#t={};this.#e.append(e,t)}else if(this.#e)this.#e.set(e,t);else this.#t??={},this.#t[e.toLowerCase()]=t;if(this.finalized)if(r?.append)this.res.headers.append(e,t);else this.res.headers.set(e,t)};status=(e)=>{this.#c=!1,this.#a=e};set=(e,t)=>{this.#i??=new Map,this.#i.set(e,t)};get=(e)=>{return this.#i?this.#i.get(e):void 0};get var(){if(!this.#i)return{};return Object.fromEntries(this.#i)}newResponse=(e,t,r)=>{if(this.#c&&!r&&!t&&this.#a===200)return new Response(e,{headers:this.#t});if(t&&typeof t!=="number"){const n=new Headers(t.headers);if(this.#e)this.#e.forEach((a,c)=>{if(c==="set-cookie")n.append(c,a);else n.set(c,a)});const i=_(n,this.#t);return new Response(e,{headers:i,status:t.status??this.#a})}const s=typeof t==="number"?t:this.#a;if(this.#t??={},this.#e??=new Headers,_(this.#e,this.#t),this.#n)this.#n.headers.forEach((n,i)=>{if(i==="set-cookie")this.#e?.append(i,n);else this.#e?.set(i,n)}),_(this.#e,this.#t);r??={};for(let[n,i]of Object.entries(r))if(typeof i==="string")this.#e.set(n,i);else{this.#e.delete(n);for(let a of i)this.#e.append(n,a)}return new Response(e,{status:s,headers:this.#e})};body=(e,t,r)=>{return typeof t==="number"?this.newResponse(e,t,r):this.newResponse(e,t)};text=(e,t,r)=>{if(!this.#t){if(this.#c&&!r&&!t)return new Response(e);this.#t={}}return this.#t["content-type"]=Oe,typeof t==="number"?this.newResponse(e,t,r):this.newResponse(e,t)};json=(e,t,r)=>{const s=JSON.stringify(e);return this.#t??={},this.#t["content-type"]="application/json; charset=UTF-8",typeof t==="number"?this.newResponse(s,t,r):this.newResponse(s,t)};html=(e,t,r)=>{if(this.#t??={},this.#t["content-type"]="text/html; charset=UTF-8",typeof e==="object"){if(!(e instanceof Promise))e=e.toString();if(e instanceof Promise)return e.then((s)=>W(s,oe.Stringify,!1,{})).then((s)=>{return typeof t==="number"?this.newResponse(s,t,r):this.newResponse(s,t)})}return typeof t==="number"?this.newResponse(e,t,r):this.newResponse(e,t)};redirect=(e,t)=>{return this.#e??=new Headers,this.#e.set("Location",e),this.newResponse(null,t??302)};notFound=()=>{return this.#f??=()=>new Response,this.#f(this)}};var U=(e,t,r)=>{return(s,n)=>{let i=-1;return a(0);async function a(c){if(c<=i)throw new Error("next() called multiple times");i=c;let o,l=!1,f;if(e[c]){if(f=e[c][0][0],s instanceof P)s.req.routeIndex=c}else f=c===e.length&&n||void 0;if(!f){if(s instanceof P&&s.finalized===!1&&r)o=await r(s)}else try{o=await f(s,()=>{return a(c+1)})}catch(h){if(h instanceof Error&&s instanceof P&&t)s.error=h,o=await t(h,s),l=!0;else throw h}if(o&&(s.finalized===!1||l))s.res=o;return s}}};var u="ALL",ce="all",ae=["get","post","put","delete","options","patch"],L="Can not add a route since the matcher is already built.",q=class extends Error{};var je=Symbol("composedHandler"),Ee=(e)=>{return e.text("404 Not Found",404)},le=(e,t)=>{if("getResponse"in e)return e.getResponse();return console.error(e),t.text("Internal Server Error",500)},Q=class{get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#s="/";routes=[];constructor(e={}){[...ae,ce].forEach((s)=>{this[s]=(n,...i)=>{if(typeof n==="string")this.#s=n;else this.addRoute(s,this.#s,n);return i.forEach((a)=>{if(typeof a!=="string")this.addRoute(s,this.#s,a)}),this}}),this.on=(s,n,...i)=>{for(let a of[n].flat()){this.#s=a;for(let c of[s].flat())i.map((o)=>{this.addRoute(c.toUpperCase(),this.#s,o)})}return this},this.use=(s,...n)=>{if(typeof s==="string")this.#s=s;else this.#s="*",n.unshift(s);return n.forEach((i)=>{this.addRoute(u,this.#s,i)}),this};const r=e.strict??!0;delete e.strict,Object.assign(this,e),this.getPath=r?e.getPath??z:se}clone(){const e=new Q({router:this.router,getPath:this.getPath});return e.routes=this.routes,e}notFoundHandler=Ee;errorHandler=le;route(e,t){const r=this.basePath(e);return t.routes.map((s)=>{let n;if(t.errorHandler===le)n=s.handler;else n=async(i,a)=>(await U([],t.errorHandler)(i,()=>s.handler(i,a))).res,n[je]=s.handler;r.addRoute(s.method,s.path,n)}),this}basePath(e){const t=this.clone();return t._basePath=w(this._basePath,e),t}onError=(e)=>{return this.errorHandler=e,this};notFound=(e)=>{return this.notFoundHandler=e,this};mount(e,t,r){let s,n;if(r)if(typeof r==="function")n=r;else n=r.optionHandler,s=r.replaceRequest;const i=n?(c)=>{const o=n(c);return Array.isArray(o)?o:[o]}:(c)=>{let o=void 0;try{o=c.executionCtx}catch{}return[c.env,o]};s||=(()=>{const c=w(this._basePath,e),o=c==="/"?0:c.length;return(l)=>{const f=new URL(l.url);return f.pathname=f.pathname.slice(o)||"/",new Request(f,l)}})();const a=async(c,o)=>{const l=await t(s(c.req.raw),...i(c));if(l)return l;await o()};return this.addRoute(u,w(e,"*"),a),this}addRoute(e,t,r){e=e.toUpperCase(),t=w(this._basePath,t);const s={path:t,method:e,handler:r};this.router.add(e,t,[r,s]),this.routes.push(s)}matchRoute(e,t){return this.router.match(e,t)}handleError(e,t){if(e instanceof Error)return this.errorHandler(e,t);throw e}dispatch(e,t,r,s){if(s==="HEAD")return(async()=>new Response(null,await this.dispatch(e,t,r,"GET")))();const n=this.getPath(e,{env:r}),i=this.matchRoute(s,n),a=new P(e,{path:n,matchResult:i,env:r,executionCtx:t,notFoundHandler:this.notFoundHandler});if(i[0].length===1){let o;try{o=i[0][0][0][0](a,async()=>{a.res=await this.notFoundHandler(a)})}catch(l){return this.handleError(l,a)}return o instanceof Promise?o.then((l)=>l||(a.finalized?a.res:this.notFoundHandler(a))).catch((l)=>this.handleError(l,a)):o??this.notFoundHandler(a)}const c=U(i[0],this.errorHandler,this.notFoundHandler);return(async()=>{try{const o=await c(a);if(!o.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return o.res}catch(o){return this.handleError(o,a)}})()}fetch=(e,...t)=>{return this.dispatch(e,t[1],t[0],e.method)};request=(e,t,r,s)=>{if(e instanceof Request){if(t!==void 0)e=new Request(e,t);return this.fetch(e,r,s)}e=e.toString();const n=/^https?:\/\//.test(e)?e:`http://localhost${w("/",e)}`,i=new Request(n,t);return this.fetch(i,r,s)};fire=()=>{addEventListener("fetch",(e)=>{e.respondWith(this.dispatch(e.request,e,void 0,e.request.method))})}};function $e(e,t){if(e.length===1)return t.length===1?e<t?-1:1:-1;if(t.length===1)return 1;if(e===S||e===$)return 1;else if(t===S||t===$)return-1;if(e===T)return 1;else if(t===T)return-1;return e.length===t.length?e<t?-1:1:t.length-e.length}var T="[^/]+",S=".*",$="(?:|/.*)",H=Symbol(),Se=new Set(".\\+*[^]$()"),B=class{index;varIndex;children=Object.create(null);insert(e,t,r,s,n){if(e.length===0){if(this.index!==void 0)throw H;if(n)return;this.index=t;return}const[i,...a]=e,c=i==="*"?a.length===0?["","",S]:["","",T]:i==="/*"?["","",$]:i.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let o;if(c){const l=c[1];let f=c[2]||T;if(l&&c[2]){if(f=f.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(f))throw H}if(o=this.children[f],!o){if(Object.keys(this.children).some((h)=>h!==S&&h!==$))throw H;if(n)return;if(o=this.children[f]=new B,l!=="")o.varIndex=s.varIndex++}if(!n&&l!=="")r.push([l,o.varIndex])}else if(o=this.children[i],!o){if(Object.keys(this.children).some((l)=>l.length>1&&l!==S&&l!==$))throw H;if(n)return;o=this.children[i]=new B}o.insert(a,t,r,s,n)}buildRegExpStr(){const t=Object.keys(this.children).sort($e).map((r)=>{const s=this.children[r];return(typeof s.varIndex==="number"?`(${r})@${s.varIndex}`:Se.has(r)?`\\${r}`:r)+s.buildRegExpStr()});if(typeof this.index==="number")t.unshift(`#${this.index}`);if(t.length===0)return"";if(t.length===1)return t[0];return"(?:"+t.join("|")+")"}};var fe=class{context={varIndex:0};root=new B;insert(e,t,r){const s=[],n=[];for(let a=0;;){let c=!1;if(e=e.replace(/\{[^}]+\}/g,(o)=>{const l=`@\\${a}`;return n[a]=[l,o],a++,c=!0,l}),!c)break}const i=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=n.length-1;a>=0;a--){const[c]=n[a];for(let o=i.length-1;o>=0;o--)if(i[o].indexOf(c)!==-1){i[o]=i[o].replace(c,n[a][1]);break}}return this.root.insert(i,t,s,this.context,r),s}buildRegExp(){let e=this.root.buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,i,a)=>{if(typeof i!=="undefined")return r[++t]=Number(i),"$()";if(typeof a!=="undefined")return s[Number(a)]=++t,"";return""}),[new RegExp(`^${e}`),r,s]}};function de(e){return ue[e]??=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}\$`)}function Fe(){ue=Object.create(null)}function Ie(e){const t=new fe,r=[];if(e.length===0)return Ne;const s=e.map((l)=>[!/\*|\/:/.test(l[0]),...l]).sort(([l,f],[h,p])=>l?1:h?-1:f.length-p.length),n=Object.create(null);for(let l=0,f=-1,h=s.length;l<h;l++){const[p,y,d]=s[l];if(p)n[y]=[d.map(([x])=>[x,Object.create(null)]),he];else f++;let g;try{g=t.insert(y,f,p)}catch(x){throw x===H?new q(y):x}if(p)continue;r[f]=d.map(([x,v])=>{const j=Object.create(null);v-=1;for(;v>=0;v--){const[b,N]=g[v];j[b]=N}return[x,j]})}const[i,a,c]=t.buildRegExp();for(let l=0,f=r.length;l<f;l++)for(let h=0,p=r[l].length;h<p;h++){const y=r[l][h]?.[1];if(!y)continue;const d=Object.keys(y);for(let g=0,x=d.length;g<x;g++)y[d[g]]=c[y[d[g]]]}const o=[];for(let l in a)o[l]=r[a[l]];return[i,o,n]}function O(e,t){if(!e)return;for(let r of Object.keys(e).sort((s,n)=>n.length-s.length))if(de(r).test(t))return[...e[r]];return}var he=[],Ne=[/^$/,[],Object.create(null)],ue=Object.create(null),X=class{name="RegExpRouter";middleware;routes;constructor(){this.middleware={[u]:Object.create(null)},this.routes={[u]:Object.create(null)}}add(e,t,r){const{middleware:s,routes:n}=this;if(!s||!n)throw new Error(L);if(!s[e])[s,n].forEach((c)=>{c[e]=Object.create(null),Object.keys(c[u]).forEach((o)=>{c[e][o]=[...c[u][o]]})});if(t==="/*")t="*";const i=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const c=de(t);if(e===u)Object.keys(s).forEach((o)=>{s[o][t]||=O(s[o],t)||O(s[u],t)||[]});else s[e][t]||=O(s[e],t)||O(s[u],t)||[];Object.keys(s).forEach((o)=>{if(e===u||e===o)Object.keys(s[o]).forEach((l)=>{c.test(l)&&s[o][l].push([r,i])})}),Object.keys(n).forEach((o)=>{if(e===u||e===o)Object.keys(n[o]).forEach((l)=>c.test(l)&&n[o][l].push([r,i]))});return}const a=m(t)||[t];for(let c=0,o=a.length;c<o;c++){const l=a[c];Object.keys(n).forEach((f)=>{if(e===u||e===f)n[f][l]||=[...O(s[f],l)||O(s[u],l)||[]],n[f][l].push([r,i-o+c+1])})}}match(e,t){Fe();const r=this.buildAllMatchers();return this.match=(s,n)=>{const i=r[s]||r[u],a=i[2][n];if(a)return a;const c=n.match(i[0]);if(!c)return[[],he];const o=c.indexOf("",1);return[i[1][o],c]},this.match(e,t)}buildAllMatchers(){const e=Object.create(null);return[...Object.keys(this.routes),...Object.keys(this.middleware)].forEach((t)=>{e[t]||=this.buildMatcher(t)}),this.middleware=this.routes=void 0,e}buildMatcher(e){const t=[];let r=e===u;if([this.middleware,this.routes].forEach((s)=>{const n=s[e]?Object.keys(s[e]).map((i)=>[i,s[e][i]]):[];if(n.length!==0)r||=!0,t.push(...n);else if(e!==u)t.push(...Object.keys(s[u]).map((i)=>[i,s[u][i]]))}),!r)return null;else return Ie(t)}};var G=class{name="SmartRouter";routers=[];routes=[];constructor(e){Object.assign(this,e)}add(e,t,r){if(!this.routes)throw new Error(L);this.routes.push([e,t,r])}match(e,t){if(!this.routes)throw new Error("Fatal error");const{routers:r,routes:s}=this,n=r.length;let i=0,a;for(;i<n;i++){const c=r[i];try{s.forEach((o)=>{c.add(...o)}),a=c.match(e,t)}catch(o){if(o instanceof q)continue;throw o}this.match=c.match.bind(c),this.routers=[c],this.routes=void 0;break}if(i===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(this.routes||this.routers.length!==1)throw new Error("No active router has been determined yet.");return this.routers[0]}};var J=class{methods;children;patterns;order=0;name;params=Object.create(null);constructor(e,t,r){if(this.children=r||Object.create(null),this.methods=[],this.name="",e&&t){const s=Object.create(null);s[e]={handler:t,possibleKeys:[],score:0,name:this.name},this.methods=[s]}this.patterns=[]}insert(e,t,r){this.name=`${e} ${t}`,this.order=++this.order;let s=this;const n=te(t),i=[];for(let o=0,l=n.length;o<l;o++){const f=n[o];if(Object.keys(s.children).includes(f)){s=s.children[f];const p=V(f);if(p)i.push(p[1]);continue}s.children[f]=new J;const h=V(f);if(h)s.patterns.push(h),i.push(h[1]);s=s.children[f]}if(!s.methods.length)s.methods=[];const a=Object.create(null),c={handler:r,possibleKeys:i.filter((o,l,f)=>f.indexOf(o)===l),name:this.name,score:this.order};return a[e]=c,s.methods.push(a),s}gHSets(e,t,r,s){const n=[];for(let i=0,a=e.methods.length;i<a;i++){const c=e.methods[i],o=c[t]||c[u],l=Object.create(null);if(o!==void 0)o.params=Object.create(null),o.possibleKeys.forEach((f)=>{const h=l[o.name];o.params[f]=s[f]&&!h?s[f]:r[f]??s[f],l[o.name]=!0}),n.push(o)}return n}search(e,t){const r=[];this.params=Object.create(null);let n=[this];const i=K(t);for(let c=0,o=i.length;c<o;c++){const l=i[c],f=c===o-1,h=[];for(let p=0,y=n.length;p<y;p++){const d=n[p],g=d.children[l];if(g)if(g.params=d.params,f===!0){if(g.children["*"])r.push(...this.gHSets(g.children["*"],e,d.params,Object.create(null)));r.push(...this.gHSets(g,e,d.params,Object.create(null)))}else h.push(g);for(let x=0,v=d.patterns.length;x<v;x++){const j=d.patterns[x],b={...d.params};if(j==="*"){const A=d.children["*"];if(A)r.push(...this.gHSets(A,e,d.params,Object.create(null))),h.push(A);continue}if(l==="")continue;const[N,k,E]=j,R=d.children[N],M=i.slice(c).join("/");if(E instanceof RegExp&&E.test(M)){b[k]=M,r.push(...this.gHSets(R,e,d.params,b));continue}if(E===!0||E instanceof RegExp&&E.test(l)){if(typeof N==="string")if(b[k]=l,f===!0){if(r.push(...this.gHSets(R,e,b,d.params)),R.children["*"])r.push(...this.gHSets(R.children["*"],e,b,d.params))}else R.params=b,h.push(R)}}}n=h}return[r.sort((c,o)=>{return c.score-o.score}).map(({handler:c,params:o})=>[c,o])]}};var Z=class{name="TrieRouter";node;constructor(){this.node=new J}add(e,t,r){const s=m(t);if(s){for(let n of s)this.node.insert(e,n,r);return}this.node.insert(e,t,r)}match(e,t){return this.node.search(e,t)}};var Y=class extends Q{constructor(e={}){super(e);this.router=e.router??new G({routers:[new X,new Z]})}};var pe=()=>"Hello World!";var ge=new Y;ge.get("/",(e)=>{const t=pe();return e.text(t)});var Kt=ge;export{Kt as default};
